# URL-encode

**Процентное кодирование** (англ. Percent-encoding, также известное как URL-кодирование) - механизм для кодирования информации в унифицированном идентификаторе ресурсов ([URI](https://ru.wikipedia.org/wiki/URI)), который используется для кодирования определенных символов в виде`%xx`, где x - цифра или буква от "a" до "f" (цифры в шестнадцатеричной системе счисления). Часто это кодирование называют «URL-кодированием» (URL - унифицированный локатор ресурсов), хотя оно используется в URI, которое кроме URL содержит также URN (унифицированные имена ресурсов). Кодирование также используется при подготовке данных типа `application/x-www-form-urlencoded`, которые применяются при передаче данных HTML-форм и HTTP-запросов.

## Процентное кодирование в URI

### Типы символов в URI

Символы, которые может включать в себя URI, делятся на зарезервированные и незарезервированные. Зарезервированными символами являются те, которые иногда имеют специальное значение. Например, обратная косая черта используется для разделения различных частей URL. Незарезервированные символы не имеют таких специальных значений и всегда обозначают только сами себя. При использовании процентного кодирования зарезервированы символы кодируются в виде специальных последовательностей символов. Списки зарезервированных и незарезервованных символов, а также обстоятельства, при которых зарезервированные символы приобретают специальное значение, понемногу меняются с каждой новой версией спецификаций, касающихся URI и URL.

### Зарезервированные символы

> ! \* ' ( ) ; : @ & = + $ , / ? # \[ ]

### Незарезервированные символы 

> A B C D E F G H I J K L M N O P Q R S T U V W X Y Z a b c d e f g h i j k l m n o p q r s t u v w x y z 0 1 2 3 4 5 6 7 8 9 - \_ . \~

Все остальные символы в URI должны кодироваться с помощью процентного кодирования.

### Процентное кодирования зарезервированных символов

Когда определенный символ имеет специальное значение в используемой схеме URI, но надо вставить сам этот символ, а не его специальное значение, то к этому символу следует применить процентное кодирование. Это предусматривает перевод символа в соответствующее ему байтовое значение в [ASCII](https://uk.wikipedia.org/wiki/ASCII), и запись этого значения в [шестнадцатеричной системе счисления](https://ru.wikipedia.org/wiki/%D0%A8%D0%B5%D1%81%D1%82%D0%BD%D0%B0%D0%B4%D1%86%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D1%87%D0%BD%D0%B0%D1%8F\_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0\_%D1%81%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F) двумя цифрами после знака `%`. Знак процента и две  шестнадцатеричные цифры после него трактуются как [управляющие символы](https://ru.wikipedia.org/wiki/%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D1%8F%D1%8E%D1%89%D0%B8%D0%B5\_%D1%81%D0%B8%D0%BC%D0%B2%D0%BE%D0%BB%D1%8B), используемые в URI на месте зарезервированного символа. Символы не относящихся к ASCII, переводятся в их байтового значения в [UTF-8](https://uk.wikipedia.org/wiki/UTF-8) и после этого таким же образом их шестнадцатеричное представление записывается после знака процента.

Например, зарезервированный символ`/`используется в URI как разделитель сегментов локатора ресурсов. Поэтому если, согласно данной схемы URI, косая черта должна быть простым символом внутри сегмента, то вместо просто символа `/`следует вставить три последовательности `%2F`.



| [`!`](https://uk.wikipedia.org/wiki/%D0%97%D0%BD%D0%B0%D0%BA\_%D0%BE%D0%BA%D0%BB%D0%B8%D0%BA%D1%83) | [`#`](https://uk.wikipedia.org/wiki/%D0%97%D0%BD%D0%B0%D0%BA\_%D1%80%D0%B5%D1%88%D1%96%D1%82%D0%BA%D0%B8) | [`$`](https://uk.wikipedia.org/wiki/%D0%A1%D0%B8%D0%BC%D0%B2%D0%BE%D0%BB\_%D0%B4%D0%BE%D0%BB%D0%B0%D1%80%D0%B0) | [`%`](https://uk.wikipedia.org/wiki/%D0%97%D0%BD%D0%B0%D0%BA\_%D0%B2%D1%96%D0%B4%D1%81%D0%BE%D1%82%D0%BA%D0%B0) | [`&`](https://uk.wikipedia.org/wiki/%D0%90%D0%BC%D0%BF%D0%B5%D1%80%D1%81%D0%B0%D0%BD%D0%B4) | [`'`](https://uk.wikipedia.org/wiki/%D0%90%D0%BF%D0%BE%D1%81%D1%82%D1%80%D0%BE%D1%84) | [`(`](https://uk.wikipedia.org/wiki/%D0%94%D1%83%D0%B6%D0%BA%D0%B8) | [`)`](https://uk.wikipedia.org/wiki/%D0%94%D1%83%D0%B6%D0%BA%D0%B8) | [`*`](https://uk.wikipedia.org/wiki/%D0%97%D1%96%D1%80%D0%BE%D1%87%D0%BA%D0%B0) | [`+`](https://uk.wikipedia.org/wiki/%D0%97%D0%BD%D0%B0%D0%BA%D0%B8\_%D0%BF%D0%BB%D1%8E%D1%81\_%D1%96\_%D0%BC%D1%96%D0%BD%D1%83%D1%81) | [`,`](https://uk.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BC%D0%B0\_\(%D1%80%D0%BE%D0%B7%D0%B4%D1%96%D0%BB%D0%BE%D0%B2%D0%B8%D0%B9\_%D0%B7%D0%BD%D0%B0%D0%BA\)) | [`/`](https://uk.wikipedia.org/wiki/%D0%9A%D0%BE%D1%81%D0%B0\_%D1%80%D0%B8%D1%81%D0%BA%D0%B0) | [`:`](https://uk.wikipedia.org/wiki/%D0%94%D0%B2%D0%BE%D0%BA%D1%80%D0%B0%D0%BF%D0%BA%D0%B0) | [`;`](https://uk.wikipedia.org/wiki/%D0%9A%D1%80%D0%B0%D0%BF%D0%BA%D0%B0\_%D0%B7\_%D0%BA%D0%BE%D0%BC%D0%BE%D1%8E) | [`=`](https://uk.wikipedia.org/wiki/%D0%97%D0%BD%D0%B0%D0%BA\_%D1%80%D1%96%D0%B2%D0%BD%D0%BE%D1%81%D1%82%D1%96) | [`?`](https://uk.wikipedia.org/wiki/%D0%97%D0%BD%D0%B0%D0%BA\_%D0%BF%D0%B8%D1%82%D0%B0%D0%BD%D0%BD%D1%8F) | [`@`](https://uk.wikipedia.org/wiki/@) | [`[`](https://uk.wikipedia.org/wiki/%D0%94%D1%83%D0%B6%D0%BA%D0%B8) | [`]`](https://uk.wikipedia.org/wiki/%D0%94%D1%83%D0%B6%D0%BA%D0%B8) |
| --------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- | -------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- |
| `%21`                                                                                               | `%23`                                                                                                     | `%24`                                                                                                           | `%25`                                                                                                           | `%26`                                                                                       | `%27`                                                                                 | `%28`                                                               | `%29`                                                               | `%2A`                                                                           | `%2B`                                                                                                                                 | `%2C`                                                                                                                                                     | `%2F`                                                                                         | `%3A`                                                                                       | `%3B`                                                                                                             | `%3D`                                                                                                           | `%3F`                                                                                                     | `%40`                                  | `%5B`                                                               | `%5D`                                                               |

Зарезервированные символы, не имеющие специального значения в данном случае, тоже могут быть закодированы с помощью процентного кодирования, но также могут использоваться сами по себе.

В компоненте URI, который называется «query» (запрос), и который начинается после символа `?`, Символ `/`и до сих пор считается зарезервированным, хотя в этой части URI не имеет никакого специального значения (если иное не указано в схеме URI). Символ необязательно кодировать процентным кодированием там, где он не имеет специального значения.

Унифицированные идентификаторы ресурсов, которые отличаются тем или зарезервирован символ закодирован процентным кодированием или нет, обычно считаются неэквивалентными, хотя и могут указывать на тот же ресурс. Если в схеме URI зарезервированный символ указывается как таковой, не имеет специального значения, то тогда унифицированные идентификаторы ресурсов с этим символом закодированным и незакодированным считаются эквивалентными.

### Процентное кодирование незарезервированных символов

Не существует потребности в кодировании незарезервированных символов. Несмотря на это, все же существует возможность кодирования незарезервированных символов, хотя это не рекомендуется. Унифицированные идентификаторы ресурсов, которые отличаются лишь тем  незарезервированный символ закодирован процентным кодированием или нет, считаются эквивалентными по определению. Но на практике, некоторые обработчики URI могут не признавать этой эквивалентности. В теории, обработчики URI должны относиться к `%41`так же как и в `A`или в `%7E`так же как и до `~`.

### Процентное кодирования символа процента

Поскольку знак процента используется как показатель начала закодированного символа, то для включения в URI самого знака процента необходимо использовать последовательность`%25`.

### Процентное кодирования других данных

Большинство схем URI включают в себя представление других данных, таких как IP-адреса или адреса в файловых системах, как компоненты URI. Спецификации схем URI должны были задавать, но на практике не задают, однозначное соответствие между символами URI и всеми возможными значениями данных, которые бы представлялись этими символами.

С введением стандарта [RFC 1738](https://tools.ietf.org/html/rfc1738) в 1994 году, было определено, что схемы обеспечивающие представление двоичных данных в URI должны разделять данные на байты и кодировать каждый из них с помощью процентного кодирования. Таким образом, например, байтовое значение `0x0F` должно кодироваться как `%0F`, а значение `0x41` как`A` или`%41`. Использование незакодированных символов для обозначения буквенно-цифровых и других незарезервированных символов используется гораздо чаще, поскольку результатом применения такого варианта является более короткие URL.

Процедура процентного кодирования бинарных данных часто использовалась, иногда некорректно или без надлежащего описания, для кодирования символьных данных. Во время ранних лет существования всемирной паутины, когда символам всегда отвечал их ASCII-код, такая практика не создавала много проблем. Тогда просто считалось что символы и байты привязаны друг к другу и можно превращать одно в другое. Однако, быстро росла необходимость представления символов не из ASCII, и схемы и протоколы URI часто не имели стандартизированных правил для подготовки символьных данных к включению в URI. В результате веб-приложения стали применять различные многобайтовые, [сословные ](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%88%D0%B8%D0%BD%D0%B0\_%D0%A2%D1%8C%D1%8E%D1%80%D0%B8%D0%BD%D0%B3%D0%B0)и другие кодировки которые могли работать с не-ASCII символами в качестве основы для процентного кодирования, что привело к сложностям и двузначности в интерпретации некоторых URI.

В частности, схемы и протоколы URI, основанные на стандартах [RFC 1738](https://tools.ietf.org/html/rfc1738) и [RFC 2396](https://tools.ietf.org/html/rfc2396),  предусматривают что символьные данные должны быть переведены в байты в соответствии с неким алгоритмом кодирования, перед тем как быть включенными в URI в виде незарезервированных символов или процентных последовательностей. Если схема не позволяет URI указать какое именно кодирование было применено или если кодирование конфликтует с процентной кодировкой ASCII-символов, то URI не может быть надежно интерпретирован. Некоторые схемы вообще не применяют кодирование, вместо этого считая что символы данных прямо соответствуют символам URI, и этим возлагают процентное кодирование ASCII-символов на конкретные имплементации схемы.

### Наиболее часто используемые символы (ASCII или UTF-8)



| Новая строка     | Пробел | `"`   | `%`   | `-`   | `.`   | `<`   | `>`   | `\`   | `^`   | `_`   | `` ` `` | `{`   | `\|`  | `}`   | `~`   |
| ---------------- | ------ | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ------- | ----- | ----- | ----- | ----- |
| `%0A` или `%0D`  | `%20`  | `%22` | `%25` | `%2D` | `%2E` | `%3C` | `%3E` | `%5C` | `%5E` | `%5F` | `%60`   | `%7B` | `%7C` | `%7D` | `%7E` |
